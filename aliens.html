<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link href="style.css" rel="stylesheet" type="text/css" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0, user-scalable=no" /> 
        <title>Bad Aliens</title>
        <script type="text/javascript">
        
            var earthSize = 67;
        
            window.onload = initialize;
            
            function initialize(){
                var ASSET_MANAGER = new AssetManager();
                ASSET_MANAGER.queueDownload('img/earth.png');
                ASSET_MANAGER.downloadAll(function(){
                    var x = 0, y = 0;
                    var sprite = ASSET_MANAGER.getAsset('img/earth.png');
                    
                    var canvas = document.getElementById("surface");
                    var ctx = canvas.getContext("2d");
                    //move coordinate system to the center of canvas
                    ctx.translate(canvas.width/2, canvas.height/2);
                    
                    // draw image centered
                    ctx.drawImage(sprite, x - earthSize/2, y - earthSize/2, earthSize, earthSize);
                    
                });
            }
            
            
            
            function AssetManager(){
                this.successCount = 0;
                this.errorCount = 0;
                this.cache = {};
                this.downloadQueue = [];
            }
            
            AssetManager.prototype.getAsset = function(path){
                return this.cache[path];
            }
            
            AssetManager.prototype.queueDownload = function(path){
                this.downloadQueue.push(path);
            }
            
            AssetManager.prototype.isDone = function(){
                return (this.downloadQueue.length == this.successCount + this.errorCount);
            }
            
            AssetManager.prototype.downloadAll = function(callback){
                for (var i=0; i<this.downloadQueue.length; i++){
                    var path = this.downloadQueue[i];
                    var img = new Image();
                    var that = this;
                    img.addEventListener("load", function(){
                       that.successCount += 1;
                       if (that.isDone()) { callback(); } 
                    });
                    img.addEventListener("error", function(){
                        that.errorCount += 1;
                        if (this.isDone()) { callback(); }
                    });
                    img.src = path;
                    this.cache[path] = img;
                }
            }
            
        </script>
    </head>
    <body>
        <canvas id="surface">
        </canvas>
    </body>
</html>
